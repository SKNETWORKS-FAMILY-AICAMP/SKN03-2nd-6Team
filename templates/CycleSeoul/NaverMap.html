<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>CitySeoul</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=oc5j6vm8zd"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }

        #content {
            width: 40%;
            display: flex;
            background-color: #f0f0f0;
        }

        #toolbar {
            width: 110px; /* 툴바의 너비 */
            background-color: #333;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
        }

        #toolbar button {
            background-color: #4CAF50; /* 녹색 계열 배경색 */
            color: #FFFFFF; /* 흰색 텍스트 색상 */
            border: none;
            padding: 10px;
            margin: 10px 0;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #main-content {
            flex-grow: 1;
            padding: 20px;
            box-sizing: border-box;
        }

        #search-container {
            margin-bottom: 20px;
            display: flex;
        }

        #search-input {
            width: calc(100% - 80px); /* 검색 버튼을 위한 여백 추가 */
            padding: 10px;
            font-size: 16px;
            box-sizing: border-box;
        }

        #search-button {
            width: 60px;
            padding: 10px;
            background-color: #444;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        #search-button:hover {
            background-color: #555;
        }

        #map {
            width: 60%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="content">
        <div id="toolbar">
            <button id="bicycle-button">자전거길</button>
            <button>툴 1</button>
            <button>툴 2</button>
        </div>
        <div id="main-content">
            <div id="search-container">
                <input type="text" id="search-input" placeholder="Search..." />
                <button id="search-button">검색</button>
            </div>
            <h1>CitySeoul</h1>
        </div>
    </div>
    <div id="map" style="width:100%;height:100%;"></div>

    <script>
        var mapDiv = document.getElementById('map'); 
        var map = new naver.maps.Map(mapDiv, {
            center: new naver.maps.LatLng(37.3595704, 127.105399),
            zoom: 12,  // 기본 줌 레벨 설정
            mapTypeControl: false  // 드롭다운 형태의 지도 유형 선택 제거
        });

        // 임시 데이터: 서울 내 위치 데이터
        var locations = [
            { name: "Location 1", lat: 37.5665, lng: 126.9780 },
            { name: "Location 2", lat: 37.5700, lng: 126.9860 },
            { name: "Location 3", lat: 37.5760, lng: 126.9920 }
        ];

        // 마커들을 저장할 배열
        var markers = [];

        // 위치 데이터에 따라 마커 생성하지만 초기에는 지도를 표시하지 않음
        locations.forEach(function(location) {
            var marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(location.lat, location.lng),
                map: null  // 초기에는 마커를 지도에 표시하지 않음
            });
            markers.push(marker);
        });

        // 줌 레벨에 따라 마커 표시/숨기기
        naver.maps.Event.addListener(map, 'zoom_changed', function() {
            var zoom = map.getZoom();  // 현재 줌 레벨을 가져옴
            if (zoom >= 16) {
                markers.forEach(function(marker) {
                    marker.setMap(map);  // 마커를 지도에 표시
                });
            } else {
                markers.forEach(function(marker) {
                    marker.setMap(null);  // 마커를 지도에서 제거
                });
            }
        });

        // 자전거 도로 레이어 추가
        var bicycleLayer = new naver.maps.BicycleLayer();

        // 자전거길 버튼에 클릭 이벤트 추가
        document.getElementById('bicycle-button').addEventListener('click', function() {
            if (bicycleLayer.getMap()) {
                bicycleLayer.setMap(null); // 자전거길 레이어 제거
                this.style.backgroundColor = '#4CAF50'; // 버튼 색상 복원
            } else {
                bicycleLayer.setMap(map); // 자전거길 레이어 추가
                this.style.backgroundColor = '#790848'; // 버튼 색상 변경
            }
        });

        // 검색 기능
        document.getElementById('search-button').addEventListener('click', function() {
            var searchQuery = document.getElementById('search-input').value;
            
            if (searchQuery) {
                fetch(`/search-location/?query=${searchQuery}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            var location = data.location;
                            var newCenter = new naver.maps.LatLng(location.lat, location.lng);
                            map.setCenter(newCenter);
                            // 마커 위치도 이동
                            markers.forEach(function(marker) {
                                marker.setPosition(newCenter);
                            });
                        } else {
                            alert(data.message);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                alert('검색어를 입력하세요.');
            }
        });

    </script>
</body>
</html>
